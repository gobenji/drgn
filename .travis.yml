# Generated by scripts/generate_travis_yml.py

dist: bionic

jobs:
  include:
    - language: python
      python: 3.8
      addons:
        apt:
          packages:
            - libbz2-dev
            - liblzma-dev
            - zlib1g-dev
      install:
      script: python setup.py build -j "$(nproc)" test
    - language: python
      python: 3.7
      addons:
        apt:
          packages:
            - libbz2-dev
            - liblzma-dev
            - zlib1g-dev
      install:
      script: python setup.py build -j "$(nproc)" test
    - language: python
      python: 3.6
      addons:
        apt:
          packages:
            - libbz2-dev
            - liblzma-dev
            - zlib1g-dev
      install:
      script: python setup.py build -j "$(nproc)" test
    - name: "vmtest Linux 5.4"
      language: minimal
      env: KERNEL=5.4
      addons:
        apt:
          packages:
            - qemu-kvm
            - rsync
            - zstd
      install: sudo adduser "$USER" kvm
      before_script:
        # The double sudo is necessary to pick up the new group membership.
        - sudo -E sudo -E -u "$USER" scripts/vmtest/run.sh -k "$KERNEL"'.*' -o -d ~ ~/root.img; exitstatus=$?
        # Exit status 0 is success, 1 is test failure (should fail in the script
        # step), anything else is an error (should fail here).
        - test $exitstatus -le 1
      script: test $exitstatus -eq 0
    - name: "vmtest Linux 5.3"
      language: minimal
      env: KERNEL=5.3
      addons:
        apt:
          packages:
            - qemu-kvm
            - rsync
            - zstd
      install: sudo adduser "$USER" kvm
      before_script:
        # The double sudo is necessary to pick up the new group membership.
        - sudo -E sudo -E -u "$USER" scripts/vmtest/run.sh -k "$KERNEL"'.*' -o -d ~ ~/root.img; exitstatus=$?
        # Exit status 0 is success, 1 is test failure (should fail in the script
        # step), anything else is an error (should fail here).
        - test $exitstatus -le 1
      script: test $exitstatus -eq 0
    - name: "vmtest Linux 4.19"
      language: minimal
      env: KERNEL=4.19
      addons:
        apt:
          packages:
            - qemu-kvm
            - rsync
            - zstd
      install: sudo adduser "$USER" kvm
      before_script:
        # The double sudo is necessary to pick up the new group membership.
        - sudo -E sudo -E -u "$USER" scripts/vmtest/run.sh -k "$KERNEL"'.*' -o -d ~ ~/root.img; exitstatus=$?
        # Exit status 0 is success, 1 is test failure (should fail in the script
        # step), anything else is an error (should fail here).
        - test $exitstatus -le 1
      script: test $exitstatus -eq 0
    - name: "vmtest Linux 4.14"
      language: minimal
      env: KERNEL=4.14
      addons:
        apt:
          packages:
            - qemu-kvm
            - rsync
            - zstd
      install: sudo adduser "$USER" kvm
      before_script:
        # The double sudo is necessary to pick up the new group membership.
        - sudo -E sudo -E -u "$USER" scripts/vmtest/run.sh -k "$KERNEL"'.*' -o -d ~ ~/root.img; exitstatus=$?
        # Exit status 0 is success, 1 is test failure (should fail in the script
        # step), anything else is an error (should fail here).
        - test $exitstatus -le 1
      script: test $exitstatus -eq 0
    - name: "vmtest Linux 4.9"
      language: minimal
      env: KERNEL=4.9
      addons:
        apt:
          packages:
            - qemu-kvm
            - rsync
            - zstd
      install: sudo adduser "$USER" kvm
      before_script:
        # The double sudo is necessary to pick up the new group membership.
        - sudo -E sudo -E -u "$USER" scripts/vmtest/run.sh -k "$KERNEL"'.*' -o -d ~ ~/root.img; exitstatus=$?
        # Exit status 0 is success, 1 is test failure (should fail in the script
        # step), anything else is an error (should fail here).
        - test $exitstatus -le 1
      script: test $exitstatus -eq 0
    - name: "vmtest Linux 4.4"
      language: minimal
      env: KERNEL=4.4
      addons:
        apt:
          packages:
            - qemu-kvm
            - rsync
            - zstd
      install: sudo adduser "$USER" kvm
      before_script:
        # The double sudo is necessary to pick up the new group membership.
        - sudo -E sudo -E -u "$USER" scripts/vmtest/run.sh -k "$KERNEL"'.*' -o -d ~ ~/root.img; exitstatus=$?
        # Exit status 0 is success, 1 is test failure (should fail in the script
        # step), anything else is an error (should fail here).
        - test $exitstatus -le 1
      script: test $exitstatus -eq 0
